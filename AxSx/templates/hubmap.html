{% extends "layout.html" %}
{% load static %}
{% block A %}
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="{% static 'css/hubmap.css' %}" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <title>Hub Map</title>
{% endblock A %}
{% block B %}
  <br />
  <section>
    <form action="{% url 'updatehub' %}" method="post">
      {% csrf_token %}
      <label for="">Update</label>
      <input type="password" name="updatehub" />
      <button type="submit">UPDATE</button>
    </form>
  </section>
  <section>
    <div id="map"></div>
  </section>
  <script src="{% static 'js/hubmap.js' %}"></script>
  <script>
  // 顯示 base
  var base = JSON.parse("{{ base_json|escapejs}}");
  // console.log(base)
  base.forEach(function (base) {
    // 設定紅色 marker
    var customIcon = L.icon({
      iconUrl: "https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png",
      iconSize: [25 * 0.75, 41 * 0.75],
      iconAnchor: [9, 30], // 設定 icon 的 anchor 點
      popupAnchor: [0, -30], // 彈出窗口錨點（相對於 iconAnchor 的位置）
    });
    // 顯示 marker
    var marker = L.marker([base.lat, base.lng], { icon: customIcon }).addTo(map);
    marker.bindPopup(
      `<b>Type: Base</b><br><b>Name: ` +
        base.name +
        `</b><br><b>IATA code: ` +
        base.iatacode +
        `</b><br><b>Country: ` +
        base.country +
        `</b><br><b>City: ` +
        base.city +
        `</b>`
    );
    marker.on("mouseover", function (e) {
      this.openPopup();
    });
    marker.on("mouseout", function (e) {
      this.closePopup();
    });
  });

  // 顯示 destination
  var destinations = JSON.parse("{{ destinations_json|escapejs }}");
  // console.log(destinations)
  destinations.forEach(function (destination) {
    // 設定綠色 marker
    var customIcon = L.icon({
      iconUrl: "https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png",
      iconSize: [25 * 0.75, 41 * 0.75],
      iconAnchor: [9, 30], // 設定 icon 的 anchor 點
      popupAnchor: [0, -30], // 彈出窗口錨點（相對於 iconAnchor 的位置）
    });
    var marker = L.marker([destination.lat, destination.lng], { icon: customIcon }).addTo(map);
    marker.bindPopup(
      `<b>Type: Destination</b><br><b><b>Name: ` +
        destination.name +
        `</b><br><b>IATA code: ` +
        destination.iatacode +
        `</b><br><b>Country: ` +
        destination.country +
        `</b><br><b>City: ` +
        destination.city +
        `</b>`
    );

    marker.on("mouseover", function () {
      this.openPopup();
    });
    marker.on("mouseout", function () {
      this.closePopup();
    });
  });

  // 顯示 hubs
  var hubs = JSON.parse("{{ hubs_json|escapejs }}");
  // console.log(hubs)
  hubs.forEach(function (hub) {
    var customIcon = L.icon({
      iconUrl: "https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png",
      iconSize: [25 * 0.75, 41 * 0.75],
      iconAnchor: [9, 30], // 設定 icon 的 anchor 點
      popupAnchor: [0, -30], // 彈出窗口錨點（相對於 iconAnchor 的位置）
    });
    var marker = L.marker([hub.lat, hub.lng], { icon: customIcon }).addTo(map);
    marker.bindPopup(
      `<b>Type: Hub</b><br><b><b>Name: ` +
        hub.name +
        `</b><br><b>IATA code: ` +
        hub.iatacode +
        `</b><br><b>Country: ` +
        hub.country +
        `</b><br><b>City: ` +
        hub.city +
        `</b>`
    );
    marker.on("mouseover", function (e) {
      this.openPopup();
    });
    marker.on("mouseout", function (e) {
      this.closePopup();
    });
  });
  </script>
  <script>{% if message %}alert("{{message}}"){% endif %}</script>
{% endblock B %}
